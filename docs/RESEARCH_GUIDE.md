# ðŸ§ª Distributed Git System Research Guide

This document provides step-by-step instructions for deploying the system, setting up the environment, and conducting the fault injection experiments for the Distributed Systems Research Project.

---

## ðŸ—ï¸ 1. Architecture & Deployment

### Prerequisites
*   **Docker Desktop**: Running.
*   **Minikube**: Installed (`brew install minikube`).
*   **Kubernetes CLI**: Installed (`kubectl`).
*   **Python 3**: For experiment scripts.

### Deployment Steps
1.  **Start Minikube**:
    ```bash
    minikube start --cpus=4 --memory=6144
    ```

2.  **Deploy System**:
    Run the automated script to build images and deploy manifests:
    ```bash
    ./scripts/deploy_k8s.sh
    ```
    *Wait for all pods to be 'Running' and 'Ready'.*

3.  **Enable Access (Tunnel)**:
    Open a **new terminal** and keep this running to expose the storage and frontend:
    ```bash
    sudo minikube tunnel
    ```
    *Enter password if prompted.*

---

## âš¡ 2. System Access & Setup

### Access Points
*   **Frontend Dashboard**: [http://localhost](http://localhost)
*   **Gitea (Internal)**: [http://localhost:3000](http://localhost:3000) (Requires port-forward)
*   **Backend API**: [http://localhost:8000](http://localhost:8000) (Requires port-forward)

### Critical Setup (First Run Only)
Before running experiments, you must register the specific research user in Gitea.

1.  **Port Forward Gitea**:
    ```bash
    kubectl port-forward svc/gitea-service 3000:3000 -n gitforge
    ```

2.  **Register User**:
    *   Visit: [http://localhost:3000](http://localhost:3000)
    *   Click **Register**.
    *   **Username**: `matthew`
    *   **Password**: *[Any password]* (e.g., `research123`)
    *   **Email**: `matthew@example.com`
    *   Click **Register Account**.

3.  **Create Repository**:
    *   Click **+** -> **New Repository**.
    *   Name: `test-repo`
    *   Click **Create Repository**.

4.  *Optional*: You can now stop the Gitea port-forward (Ctrl+C). Only the Backend needs to talk to Gitea now.

---

## ðŸ’¥ 3. conducting Experiments

The research focuses on **Recovery Time** (RTO) during **Single-Node Failures**.

### A. Manual Verification (Dashboard)
1.  Go to [http://localhost/status](http://localhost/status).
2.  Verify **Backend API** is "Healthy" (Green).
3.  Verify **CockroachDB** is "Healthy" (Green).
4.  Use the **"Research Control Panel"** to trigger a simulated test.

### B. Automated Fault Injection Suite (The Real Stuff)
This suite uses the Python controller to:
1.  Inject a **Pod Kill** fault (killing `gitea-0` or a DB node).
2.  Measure the time until the system returns `200 OK`.
3.  Record the data to a CSV.

**Steps:**

1.  **Port Forward Backend** (Required for the script to poll health):
    ```bash
    kubectl port-forward svc/backend 8000:8000 -n gitforge
    ```
    *(Keep this running in a separate terminal)*

2.  **Run the Experiment Suite**:
    In your main terminal:
    ```bash
    ./scripts/run_experiments.sh
    ```

3.  **Observe**:
    *   The script will perform **20 runs**.
    *   Each run waits for stabilization, injects failure, measures recovery, and cools down.
    *   Results are saved to: `experiment_results_checkpointing_30s.csv` (or similar).

---

## ðŸ“Š 4. Data Analysis

1.  **Locate Data**:
    Check the project root for `.csv` files generated by the experiment controller.

2.  **Format**:
    *   `run_id`: Experiment iteration.
    *   `injection_delay`: Random wait time before fault.
    *   `recovery_time_seconds`: Core metric (Lower is better).

3.  **Interpretation**:
    *   **< 5s**: Excellent resilience (likely transparent failover).
    *   **5s - 30s**: Standard container restart time.
    *   **> 60s**: Issue with readiness probes or state recovery.

---

## ðŸ§¹ Cleanup

To stop the cluster and save resources:
```bash
minikube stop
```

To delete the cluster (wipes all data):
```bash
minikube delete
```
